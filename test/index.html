<html>
<head>
    <title>WolframNotebookEmbedding test</title>
    <style>
        #path {
            width: 300px;
        }
    </style>
</head>
<body>

<h1>WolframNotebookEmbedding test</h1>
<p>
    Enter the path (including user ID) or UUID of a cloud object on your localhost:
    <input id="path" value="30c45b23-d17e-4177-bc52-59056f613367" />
    <button onclick="mountNotebook()">Mount Notebook</button>
</p>
<p>
    <button onclick="increaseWidth()">Increase Width</button>
    <button onclick="resetX()">Reset x</button>
</p>
<p>
    Current dimensions: <span id="dimensions"></span>
</p>
<div id="container" style="position: relative"></div>
<script src="./dist/wolfram-notebook-embedding.dev.js"></script>
<script>
    let nbLoading = null;
    let width = 500;

    function mountNotebook() {
        const url = 'http://localhost/objects/' + document.getElementById('path').value;
        nbLoading = WolframNotebookEmbedding.mount(url, document.getElementById('container'), {
            maxWidth: width,
            maxHeight: 400,
            allowInteract: true
        });
        nbLoading.then(nb => {
            nb.addEventListener('resize', dimensions => {
                const span = document.getElementById('dimensions');
                span.innerHTML = dimensions.width + ' x ' + dimensions.height;
            });
        });
    }

    function increaseWidth() {
        if (nbLoading) {
            width += 100;
            nbLoading.then(nb => {
                nb.setAttributes({maxWidth: width});
            });
        }
    }

    function resetX() {
        if (nbLoading) {
            nbLoading.then(nb => {
                nb.getCells().then(({cells}) => {
                    const lastCell = cells[cells.length - 1];
                    return nb.setDynamicModuleVariable({
                        cellId: lastCell.id,
                        name: 'x$$',
                        value: 0
                    });
                })
            })
        }
    }
</script>

</body>
</html>
